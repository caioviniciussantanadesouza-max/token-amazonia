<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel Amaz√¥nia ‚Äî Token Amaz√¥nia</title>

  <!-- Leaflet (MAPA) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    :root{
      --bg:#05080f;
      --panel: rgba(6,10,18,.78);
      --line: rgba(26,255,140,.25);
      --neon:#1aff8c;
      --text:#e4e9f2;
      --muted:#9bb0d3;
    }
    *{ box-sizing:border-box; }

    html, body { height: 100%; margin: 0; background: var(--bg); }
    body { font-family: Arial, Helvetica, sans-serif; color: var(--text); }

    /* MAPA ocupa a tela inteira */
    #map { height: 100vh; width: 100%; background: #05080f; }

    /* Top HUD */
    .hud{
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      display:flex;
      gap:12px;
      padding:10px 14px;
      background: var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      backdrop-filter: blur(10px);
      align-items:center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      transition:.2s;
      background: rgba(0,0,0,.25);
      font-weight:800;
      white-space:nowrap;
    }
    .chip:hover{
      border-color: rgba(26,255,140,.55);
      box-shadow:0 0 18px rgba(26,255,140,.15);
    }

    .right{
      display:flex;
      gap:10px;
      align-items:center;
      margin-left: 6px;
    }

    .btn{
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(0,0,0,.25);
      color: var(--text);
      text-decoration:none;
      font-weight:900;
      transition:.2s;
    }
    .btn:hover{
      border-color: rgba(26,255,140,.55);
      box-shadow:0 0 18px rgba(26,255,140,.15);
    }

    /* Legenda */
    .legend{
      position: fixed;
      bottom: 18px;
      left: 18px;
      z-index: 9999;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      backdrop-filter: blur(10px);
      width: 260px;
    }
    .legend h3{
      margin: 0 0 8px;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .bar{
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg,
        rgba(255,60,60,.95),
        rgba(255,210,60,.95),
        rgba(26,255,140,.95)
      );
      border: 1px solid rgba(255,255,255,.08);
    }
    .legend .row{
      display:flex;
      justify-content: space-between;
      font-size: 12px;
      color: rgba(228,233,242,.80);
      margin-top: 6px;
    }

    /* Status */
    .status{
      position: fixed;
      bottom: 18px;
      right: 18px;
      z-index: 9999;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      backdrop-filter: blur(10px);
      width: min(360px, calc(100vw - 36px));
      font-size: 12px;
      color: rgba(228,233,242,.85);
      line-height: 1.45;
    }
    .dot{
      display:inline-block;
      width:10px;
      height:10px;
      border-radius:50%;
      margin-right:8px;
      background: rgba(26,255,140,.95);
      box-shadow: 0 0 12px rgba(26,255,140,.35);
      vertical-align: middle;
    }

    /* Modal */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.75);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 10000;
    }
    .modal{
      width:min(820px, calc(100vw - 28px));
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px;
      backdrop-filter: blur(10px);
      box-shadow:0 10px 40px rgba(0,0,0,.55);
    }
    .modalTitle{ font-weight:900; font-size: 16px; }
    .modalBody{ margin-top:10px; color:#dfe7ff; line-height:1.6; }
    .muted{ color: var(--muted); }
    .close{
      float:right;
      cursor:pointer;
      font-weight:900;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
    }
    .close:hover{ border-color: rgba(26,255,140,.55); }
    ul.bullet{ padding-left:18px; }
    ul.bullet li{ margin:8px 0; }

    /* remove qualquer ‚Äúmargem branca‚Äù padr√£o do leaflet */
    .leaflet-container { background: #05080f; }
  </style>
</head>

<body>

  <!-- HUD do painel (fica aqui, no dashboard, como voc√™ decidiu) -->
  <div class="hud">
    <div class="chip" onclick="openModal('oquee')">üåø O que √©</div>
    <div class="chip" onclick="openModal('comofunciona')">‚öôÔ∏è Como funciona</div>
    <div class="chip" onclick="openModal('painel')">üìä Painel</div>

    <div class="right">
      <a class="btn" href="index.html">‚¨Ö Voltar</a>
      <button class="btn" onclick="carregarDados()">‚Üª Atualizar dados</button>
    </div>
  </div>

  <!-- MAPA -->
  <div id="map"></div>

  <!-- Legenda -->
  <div class="legend">
    <h3>Escala Bioecol√≥gica (0‚Äì100)</h3>
    <div class="bar"></div>
    <div class="row">
      <span>Baixa</span><span>M√©dia</span><span>Alta</span>
    </div>
  </div>

  <!-- Status -->
  <div class="status" id="statusBox">
    <span class="dot"></span>
    <strong>Sistema ativo ‚Äî Amaz√¥nia</strong><br>
    Dados p√∫blicos ‚Ä¢ Atualiza√ß√£o cont√≠nua<br>
    <span class="muted" id="statusMsg">Carregando pontos‚Ä¶</span>
  </div>

  <!-- MODAL -->
  <div class="modalOverlay" id="modalOverlay" onclick="overlayClick(event)">
    <div class="modal">
      <div class="close" onclick="closeModal()">Fechar ‚úï</div>
      <div class="modalTitle" id="modalTitle"></div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // ====== 1) MAPA BASE (sem r√≥tulos de cidades) ======
    const map = L.map("map", {
      zoomControl: false,
      attributionControl: false
    });

    // Fundo escuro sem labels (sem nomes de cidades)
    L.tileLayer(
      "https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png",
      { maxZoom: 19 }
    ).addTo(map);

    // ‚ÄúEnquadra‚Äù regi√£o amaz√¥nica (aproximado)
    const amazonBounds = L.latLngBounds(
      L.latLng(-20.5, -79.5), // SW
      L.latLng(  6.5, -44.0)  // NE
    );

    map.fitBounds(amazonBounds);
    map.setMaxBounds(amazonBounds.pad(0.35)); // deixa uma folga
    map.on("drag", () => map.panInsideBounds(amazonBounds.pad(0.35), { animate: false }));

    // Zoom control no canto inferior direito (HUD)
    L.control.zoom({ position: "bottomright" }).addTo(map);

    // Camada de pontos
    const layerPontos = L.layerGroup().addTo(map);

    // ====== 2) CORES (verde / amarelo / vermelho) ======
    function corPorValor(v){
      // v esperado 0..100
      const n = Number(v);
      if (Number.isNaN(n)) return "rgba(160,170,190,.85)";
      if (n < 34) return "rgba(255,60,60,.95)";
      if (n < 67) return "rgba(255,210,60,.95)";
      return "rgba(26,255,140,.95)";
    }

    function limparPontos(){
      layerPontos.clearLayers();
    }

    // ====== 3) FALLBACK: se n√£o tiver dados.json, gera pontos falsos ======
    function gerarPontosFake(qtd = 50){
      const pts = [];
      for(let i=0;i<qtd;i++){
        const lat = -18 + Math.random()*22; // -18..4
        const lon = -75 + Math.random()*28; // -75..-47
        const bio = Math.floor(Math.random()*101);
        pts.push({ lat, lon, bio });
      }
      return { points: pts, fonte: "FAKE_LOCAL" };
    }

    function setStatus(msg){
      document.getElementById("statusMsg").textContent = msg;
    }

    // ====== 4) CARREGAR DADOS REAIS (dados.json) ======
    async function carregarDados(){
      try{
        limparPontos();
        setStatus("Buscando dados.json‚Ä¶");

        // tenta buscar dados.json do reposit√≥rio
        const res = await fetch("dados.json", { cache: "no-store" });

        let data;
        if(!res.ok){
          // N√ÉO deixa branco: usa fallback
          data = gerarPontosFake(60);
          setStatus("Sem dados.json (usando pontos de demonstra√ß√£o).");
        } else {
          data = await res.json();
          setStatus("Dados carregados (pontos reais do arquivo).");
        }

        if(!data.points || !Array.isArray(data.points)){
          data = gerarPontosFake(60);
          setStatus("Formato inv√°lido (usando pontos de demonstra√ß√£o).");
        }

        for(const p of data.points){
          // aceita "bio" ou "valor" pra n√£o quebrar nunca
          const v = (p.bio ?? p.valor ?? p.v ?? 0);
          const c = corPorValor(v);

          // Ponto principal
          const marker = L.circleMarker([p.lat, p.lon], {
            radius: 7,
            color: c,
            weight: 2,
            fillColor: c,
            fillOpacity: 0.35
          });

          // Popup simples (sem cidade / sem bagun√ßa)
          marker.bindPopup(
            `Bio: <strong>${v}</strong><br>lat: ${p.lat.toFixed(4)} | lon: ${p.lon.toFixed(4)}`
          );

          marker.addTo(layerPontos);

          // Halo (efeito HUD)
          L.circleMarker([p.lat, p.lon], {
            radius: 18,
            color: c,
            weight: 0,
            fillColor: c,
            fillOpacity: 0.12
          }).addTo(layerPontos);
        }

      }catch(err){
        // tamb√©m N√ÉO deixa branco
        const data = gerarPontosFake(60);
        for(const p of data.points){
          const c = corPorValor(p.bio);
          L.circleMarker([p.lat, p.lon], { radius: 7, color:c, weight:2, fillColor:c, fillOpacity:0.35 }).addTo(layerPontos);
          L.circleMarker([p.lat, p.lon], { radius:18, color:c, weight:0, fillColor:c, fillOpacity:0.12 }).addTo(layerPontos);
        }
        setStatus("Erro ao carregar dados reais (mostrando demonstra√ß√£o).");
        console.error(err);
      }
    }

    // Carrega ao abrir
    carregarDados();

    // ====== MODAIS (mesmo conte√∫do que voc√™ j√° aprovou) ======
    const content = {
      oquee: {
        title: "üåø O que √© o Token Amaz√¥nia",
        body: `
          <p>
            O Token Amaz√¥nia √© um projeto de transpar√™ncia ambiental que utiliza
            <strong>dados p√∫blicos de sat√©lite</strong> para monitorar, em escala continental,
            o estado ecol√≥gico da floresta amaz√¥nica.
          </p>
          <p class="muted">
            Este site funciona como a vitrine t√©cnica e institucional do sistema.
          </p>
        `
      },
      comofunciona: {
        title: "‚öôÔ∏è Como funciona",
        body: `
          <p>
            Dados do programa <strong>Sentinel-2</strong> s√£o processados continuamente por meio do
            <strong>Google Earth Engine</strong>.
          </p>
          <p class="muted">
            A partir desses dados, √© gerado um <strong>√≠ndice ecol√≥gico sint√©tico</strong> que
            representa a atividade biol√≥gica da Amaz√¥nia ao longo do tempo.
          </p>
        `
      },
      painel: {
        title: "üìä Painel Amaz√¥nia ‚Äî voc√™ encontra",
        body: `
          <ul class="bullet">
            <li><strong>Sistema ativo da Amaz√¥nia</strong></li>
            <li><strong>Dados p√∫blicos</strong></li>
            <li><strong>Atualiza√ß√£o cont√≠nua</strong></li>
          </ul>
          <p class="muted">
            Painel interativo com mapas e s√©ries temporais baseados em dados oficiais de sensoriamento remoto.
          </p>
        `
      }
    };

    function openModal(key){
      const overlay = document.getElementById("modalOverlay");
      const titleEl = document.getElementById("modalTitle");
      const bodyEl = document.getElementById("modalBody");
      const item = content[key];
      if(!item) return;
      titleEl.innerHTML = item.title;
      bodyEl.innerHTML = item.body;
      overlay.style.display = "flex";
    }
    function closeModal(){
      document.getElementById("modalOverlay").style.display = "none";
    }
    function overlayClick(e){
      if(e.target.id === "modalOverlay") closeModal();
    }
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape") closeModal();
    });
  </script>
</body>
</html>
