<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel Amaz√¥nia ‚Äî Token Amaz√¥nia</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">

  <style>
    :root{
      --bg:#05080f;
      --panel: rgba(6,10,18,.78);
      --panel2: rgba(6,10,18,.62);
      --line: rgba(26,255,140,.25);
      --line2: rgba(26,255,140,.18);
      --neon:#1aff8c;
      --text:#e4e9f2;
      --muted:#9bb0d3;
      --warn:#ffd23c;
      --bad:#ff3c3c;
      --good:#1aff8c;
    }

    *{ box-sizing:border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); }
    body { font-family: Arial, Helvetica, sans-serif; color: var(--text); overflow: hidden; }

    /* ====== FUNDO / HUD FEEL ====== */
    .bgfx{
      position: fixed; inset: 0; z-index: 0;
      background:
        radial-gradient(circle at 20% 10%, rgba(40,110,255,.12), transparent 40%),
        radial-gradient(circle at 80% 20%, rgba(26,255,140,.10), transparent 45%),
        radial-gradient(circle at 50% 90%, rgba(255,210,60,.06), transparent 40%),
        linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.70));
      pointer-events: none;
    }
    .scanlines{
      position: fixed; inset: 0; z-index: 1; pointer-events: none;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.03),
        rgba(255,255,255,.03) 1px,
        rgba(0,0,0,0) 4px,
        rgba(0,0,0,0) 7px
      );
      mix-blend-mode: overlay;
      opacity: .25;
    }

    /* ====== GRID LAYOUT ====== */
    .grid{
      position: relative;
      z-index: 2;
      height: 100vh;
      width: 100vw;
      display: grid;
      grid-template-columns: 340px 1fr 340px;
      grid-template-rows: 86px 1fr 140px;
      gap: 14px;
      padding: 14px;
    }

    /* Top bar */
    .topbar{
      grid-column: 1 / 4;
      grid-row: 1;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 14px;
      background: var(--panel);
      border:1px solid var(--line);
      border-radius: 18px;
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 40px rgba(0,0,0,.45);
    }
    .brand{
      display:flex; flex-direction:column; gap:4px;
      min-width: 220px;
    }
    .brand .title{
      font-weight: 900; letter-spacing:.3px; font-size: 15px;
    }
    .brand .sub{
      font-size: 12px; color: rgba(228,233,242,.78);
    }
    .chips{
      display:flex; gap:10px; flex-wrap: wrap; justify-content: center;
    }
    .chip{
      display:flex; align-items:center; gap:8px;
      padding: 10px 14px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(0,0,0,.25);
      cursor:pointer;
      user-select:none;
      transition:.2s;
      font-weight: 800;
      white-space: nowrap;
    }
    .chip:hover{
      border-color: rgba(26,255,140,.55);
      box-shadow: 0 0 18px rgba(26,255,140,.15);
    }
    .actions{
      display:flex; gap:10px; align-items:center;
    }
    .btn{
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(0,0,0,.25);
      color: var(--text);
      text-decoration:none;
      font-weight: 900;
      transition:.2s;
      cursor:pointer;
    }
    .btn:hover{
      border-color: rgba(26,255,140,.55);
      box-shadow:0 0 18px rgba(26,255,140,.15);
    }

    /* Side panels */
    .panel{
      background: var(--panel);
      border:1px solid var(--line);
      border-radius: 18px;
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 40px rgba(0,0,0,.45);
      overflow: hidden;
      position: relative;
    }
    .panelHeader{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .panelHeader .h{
      font-weight: 900;
      letter-spacing:.2px;
      font-size: 13px;
    }
    .panelBody{
      padding: 12px 14px;
      color: rgba(228,233,242,.88);
      font-size: 12px;
      line-height: 1.5;
    }
    .muted{ color: var(--muted); }

    .left{ grid-column:1; grid-row:2; }
    .right{ grid-column:3; grid-row:2; }
    .bottom{
      grid-column: 1 / 4;
      grid-row: 3;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 14px;
    }

    /* Center map frame */
    .center{
      grid-column:2;
      grid-row:2;
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      border:1px solid var(--line);
      background: rgba(0,0,0,.30);
      box-shadow: 0 12px 50px rgba(0,0,0,.55);
    }
    #map{ height: 100%; width: 100%; background: #05080f; }

    /* Hologram overlay */
    .holoOverlay{
      position:absolute; inset:0;
      pointer-events:none;
      z-index: 500;
      background:
        radial-gradient(circle at 50% 50%, rgba(26,255,140,.08), transparent 45%),
        radial-gradient(circle at 30% 30%, rgba(40,110,255,.07), transparent 40%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,0));
      mix-blend-mode: screen;
      opacity: .85;
    }
    .holoFrame{
      position:absolute; inset: 10px;
      border-radius: 16px;
      border: 1px solid rgba(26,255,140,.22);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      pointer-events:none;
      z-index: 600;
    }
    .corner{
      position:absolute; width: 26px; height: 26px;
      border: 2px solid rgba(26,255,140,.40);
      border-right: none; border-bottom:none;
      z-index: 650;
      pointer-events:none;
      filter: drop-shadow(0 0 10px rgba(26,255,140,.18));
    }
    .c1{ top: 10px; left: 10px; border-right:none; border-bottom:none; }
    .c2{ top: 10px; right: 10px; transform: rotate(90deg); }
    .c3{ bottom: 10px; right: 10px; transform: rotate(180deg); }
    .c4{ bottom: 10px; left: 10px; transform: rotate(270deg); }

    .mapTitle{
      position:absolute;
      top: 14px;
      left: 14px;
      z-index: 800;
      background: var(--panel2);
      border: 1px solid var(--line2);
      border-radius: 14px;
      padding: 10px 12px;
      backdrop-filter: blur(10px);
      display:flex;
      flex-direction: column;
      gap: 6px;
      min-width: 240px;
    }
    .mapTitle .t{
      font-weight: 900;
      letter-spacing:.2px;
      font-size: 13px;
    }
    .dot{
      display:inline-block;
      width:10px; height:10px;
      border-radius:50%;
      background: rgba(26,255,140,.95);
      box-shadow: 0 0 12px rgba(26,255,140,.35);
      vertical-align: middle;
      margin-right: 8px;
    }
    .miniRow{
      font-size: 12px;
      color: rgba(228,233,242,.82);
    }

    .legend{
      position:absolute;
      bottom: 14px;
      left: 14px;
      z-index: 800;
      background: var(--panel2);
      border: 1px solid var(--line2);
      border-radius: 14px;
      padding: 10px 12px;
      backdrop-filter: blur(10px);
      width: 270px;
    }
    .legend .h{ font-weight: 900; font-size: 12px; margin-bottom: 8px; }
    .bar{
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,60,60,.95), rgba(255,210,60,.95), rgba(26,255,140,.95));
      border: 1px solid rgba(255,255,255,.08);
    }
    .legend .row{
      display:flex;
      justify-content: space-between;
      font-size: 11px;
      color: rgba(228,233,242,.78);
      margin-top: 6px;
    }

    /* Pulse marker (divIcon) */
    .pulse{
      width: 14px;
      height: 14px;
      border-radius: 50%;
      position: relative;
      box-shadow: 0 0 18px rgba(26,255,140,.25);
      border: 2px solid rgba(255,255,255,.25);
      background: rgba(26,255,140,.90);
    }
    .pulse::after{
      content:"";
      position:absolute;
      inset:-12px;
      border-radius: 50%;
      background: currentColor;
      opacity: .10;
      animation: ping 1.8s infinite;
    }
    @keyframes ping{
      0%{ transform: scale(.35); opacity: .18; }
      100%{ transform: scale(1.2); opacity: 0; }
    }

    /* Modal */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.75);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 99999;
      padding: 16px;
    }
    .modal{
      width:min(860px, calc(100vw - 28px));
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px;
      backdrop-filter: blur(10px);
      box-shadow:0 10px 40px rgba(0,0,0,.55);
    }
    .modalTitle{ font-weight:900; font-size: 16px; }
    .modalBody{ margin-top:10px; color:#dfe7ff; line-height:1.6; font-size: 13px; }
    .close{
      float:right;
      cursor:pointer;
      font-weight:900;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background: rgba(0,0,0,.20);
    }
    .close:hover{ border-color: rgba(26,255,140,.55); }

    ul.bullet{ padding-left:18px; margin: 10px 0; }
    ul.bullet li{ margin:8px 0; }

    /* Fallback */
    .fallback{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      background: #05080f;
      z-index: 200000;
      padding: 24px;
      text-align:center;
    }
    .fallback .card{
      max-width: 760px;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 18px;
    }

    /* Leaflet fine-tune */
    .leaflet-container{ background:#05080f; }
    .leaflet-control-attribution{ display:none !important; }
    .leaflet-popup-content{ font-size: 12px; }

    @media (max-width: 980px){
      body{ overflow:auto; }
      .grid{
        height: auto;
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto auto;
      }
      .topbar{ grid-column:1; }
      .left{ grid-column:1; grid-row:auto; }
      .center{ grid-column:1; height: 66vh; min-height: 520px; }
      .right{ grid-column:1; }
      .bottom{ grid-column:1; grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="bgfx"></div>
  <div class="scanlines"></div>

  <div class="grid">
    <!-- TOP BAR -->
    <div class="topbar">
      <div class="brand">
        <div class="title">PAINEL AMAZ√îNIA ‚Äî Monitoramento Bioecol√≥gico</div>
        <div class="sub">Dados p√∫blicos ‚Ä¢ Atualiza√ß√£o cont√≠nua ‚Ä¢ Escala 0‚Äì100</div>
      </div>

      <div class="chips">
        <div class="chip" onclick="openModal('oquee')">üåø O que √©</div>
        <div class="chip" onclick="openModal('comofunciona')">‚öôÔ∏è Como funciona</div>
        <div class="chip" onclick="openModal('painel')">üìä Painel</div>
      </div>

      <div class="actions">
        <a class="btn" href="index.html">‚¨Ö Voltar</a>
        <button class="btn" onclick="atualizarTudo()">‚Üª Atualizar</button>
      </div>
    </div>

    <!-- LEFT PANEL -->
    <div class="panel left">
      <div class="panelHeader">
        <div class="h">üì° Camadas P√∫blicas</div>
        <div class="muted" id="camadasStatus">online</div>
      </div>
      <div class="panelBody">
        <div><strong>Base:</strong> Sat√©lite (mundo real)</div>
        <div class="muted">Fonte: Esri World Imagery (visual sat√©lite)</div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,.06); margin:10px 0;">
        <div><strong>Pontos Bio (0‚Äì100):</strong></div>
        <div class="muted">
          Agora: calculado com dados clim√°ticos p√∫blicos em tempo real (umidade, nuvens e precipita√ß√£o).
          Pr√≥ximo passo: trocar para √≠ndice por sat√©lite (NDVI/Sentinel).
        </div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,.06); margin:10px 0;">
        <div><strong>Atualiza√ß√£o:</strong> <span id="lastUpdate">‚Äî</span></div>
      </div>
    </div>

    <!-- CENTER MAP -->
    <div class="center">
      <div id="map"></div>

      <div class="holoOverlay"></div>
      <div class="holoFrame"></div>
      <div class="corner c1"></div><div class="corner c2"></div><div class="corner c3"></div><div class="corner c4"></div>

      <div class="mapTitle">
        <div class="t"><span class="dot"></span>Sistema ativo ‚Äî Amaz√¥nia</div>
        <div class="miniRow">BioIndex: <strong id="bioMedia">‚Äî</strong> (m√©dia)</div>
        <div class="miniRow muted" id="statusMsg">Inicializando‚Ä¶</div>
      </div>

      <div class="legend">
        <div class="h">Escala Bioecol√≥gica (0‚Äì100)</div>
        <div class="bar"></div>
        <div class="row"><span>Baixa</span><span>M√©dia</span><span>Alta</span></div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="panel right">
      <div class="panelHeader">
        <div class="h">üìä Leituras em tempo real</div>
        <div class="muted" id="pontosCount">0 pontos</div>
      </div>
      <div class="panelBody" id="rightBody">
        <div><strong>Resumo</strong></div>
        <div class="muted">
          Clique em um ponto no mapa para ver os dados p√∫blicos usados no c√°lculo do √≠ndice.
        </div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,.06); margin:10px 0;">
        <div><strong>√öltimo ponto selecionado</strong></div>
        <div class="muted" id="selInfo">‚Äî</div>
      </div>
    </div>

    <!-- BOTTOM ROW -->
    <div class="bottom">
      <div class="panel">
        <div class="panelHeader">
          <div class="h">üìà S√©rie temporal (MVP)</div>
          <div class="muted">placeholder</div>
        </div>
        <div class="panelBody">
          <div class="muted">
            Pr√≥ximo passo: gr√°fico real de NDVI/biomassa (via Sentinel-2/GEE).  
            Hoje o painel j√° est√° pronto (layout + mapa + pontos + legenda + HUD).
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panelHeader">
          <div class="h">üõ∞Ô∏è Integridade / Cobertura</div>
          <div class="muted">placeholder</div>
        </div>
        <div class="panelBody">
          <div class="muted">
            Aqui entraremos com camadas reais (desmatamento, fogo, rios, etc.) conforme voc√™ escolher
            as fontes oficiais (INPE, MapBiomas, NASA, etc.).
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panelHeader">
          <div class="h">üîí Transpar√™ncia</div>
          <div class="muted">legal</div>
        </div>
        <div class="panelBody">
          Token Amaz√¥nia ‚Äî Transpar√™ncia ambiental baseada em dados p√∫blicos.<br>
          <span class="muted">Este projeto n√£o constitui oferta de investimento. Plataforma de monitoramento ambiental.</span>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modalOverlay" id="modalOverlay" onclick="overlayClick(event)">
    <div class="modal">
      <div class="close" onclick="closeModal()">Fechar ‚úï</div>
      <div class="modalTitle" id="modalTitle"></div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <div class="fallback" id="fallback">
    <div class="card">
      <h2 style="margin:0 0 8px;">Erro: o painel n√£o carregou</h2>
      <p style="margin:0 0 10px; color: rgba(228,233,242,.85); line-height:1.55;">
        O navegador n√£o conseguiu baixar a biblioteca do mapa (Leaflet). Isso gera <strong>"L is not defined"</strong>.
      </p>
      <p style="margin:0; color: rgba(228,233,242,.75); line-height:1.55;">
        Recarregue com <strong>Ctrl+F5</strong>. Se persistir, me diga e eu troco o CDN automaticamente.
      </p>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ====== Helpers HUD ======
    function setStatus(msg){ document.getElementById("statusMsg").textContent = msg; }
    function setLastUpdate(){
      const d = new Date();
      document.getElementById("lastUpdate").textContent =
        d.toLocaleString("pt-BR", { hour12:false });
    }

    // Leaflet fallback
    if (typeof L === "undefined") {
      document.getElementById("fallback").style.display = "flex";
      throw new Error("Leaflet n√£o carregou (L is undefined).");
    }

    // ====== MAPA ======
    const map = L.map("map", { zoomControl: false, attributionControl: false });

    // Sat√©lite real (sem labels)
    // (OBS: Esri tem termos pr√≥prios; para MVP em Pages funciona bem)
    L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", {
      maxZoom: 19
    }).addTo(map);

    // Limite ‚Äúmacro Amaz√¥nia‚Äù (aprox.)
    const amazonBounds = L.latLngBounds(
      L.latLng(-20.5, -79.5),
      L.latLng(  6.5, -44.0)
    );
    map.fitBounds(amazonBounds);
    map.setMaxBounds(amazonBounds.pad(0.30));
    map.on("drag", () => map.panInsideBounds(amazonBounds.pad(0.30), { animate: false }));
    L.control.zoom({ position: "bottomright" }).addTo(map);

    // Camadas
    const layerPontos = L.layerGroup().addTo(map);

    // ====== Cor por valor ======
    function corPorValor(v){
      const n = Number(v);
      if (Number.isNaN(n)) return "rgba(160,170,190,.85)";
      if (n < 34) return "rgba(255,60,60,.95)";
      if (n < 67) return "rgba(255,210,60,.95)";
      return "rgba(26,255,140,.95)";
    }

    // ====== √çcone pulsante com cor ======
    function pulseIcon(cssColor){
      const div = document.createElement("div");
      div.className = "pulse";
      div.style.background = cssColor;
      div.style.color = cssColor;      // usado no ::after (currentColor)
      div.style.borderColor = "rgba(255,255,255,.22)";
      return L.divIcon({
        className: "",
        html: div.outerHTML,
        iconSize: [14,14],
        iconAnchor: [7,7]
      });
    }

    function limparPontos(){ layerPontos.clearLayers(); }

    // ====== Pontos fixos (macro) ‚Äî voc√™ pode mudar depois ======
    // (coordenadas espalhadas no bioma pra ter leitura ‚Äúcontinental‚Äù)
    const pontosBase = [
      { nome:"Noroeste", lat:-2.7,  lon:-67.8 },
      { nome:"Manaus",   lat:-3.1,  lon:-60.0 },
      { nome:"Tapaj√≥s",  lat:-4.3,  lon:-55.0 },
      { nome:"Xingu",    lat:-3.6,  lon:-52.2 },
      { nome:"Sul 1",    lat:-9.6,  lon:-63.9 },
      { nome:"Sul 2",    lat:-10.6, lon:-56.6 },
      { nome:"Leste",    lat:-2.0,  lon:-48.0 },
      { nome:"Norte",    lat: 1.0,  lon:-60.5 }
    ];

    // ====== DADOS REAIS (clima ao vivo) via Open-Meteo ======
    // Retorna: temperatura, umidade, nuvens e precipita√ß√£o (p√∫blico e sem chave)
    async function fetchClima(lat, lon){
      const url =
        "https://api.open-meteo.com/v1/forecast" +
        `?latitude=${encodeURIComponent(lat)}` +
        `&longitude=${encodeURIComponent(lon)}` +
        "&current=temperature_2m,relative_humidity_2m,precipitation,cloud_cover" +
        "&timezone=UTC";

      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error("Open-Meteo erro " + res.status);
      return await res.json();
    }

    // ====== BioIndex REAL (derivado de dados reais) ======
    // F√≥rmula simples (MVP): umidade pesa mais, nuvem + chuva influenciam
    function calcBioIndex(current){
      const hum = Number(current.relative_humidity_2m ?? 0); // 0-100
      const cloud = Number(current.cloud_cover ?? 0);        // 0-100
      const rain = Number(current.precipitation ?? 0);       // mm
      const t = Number(current.temperature_2m ?? 0);         // ¬∞C

      // normaliza√ß√µes / pesos (ajust√°veis)
      const rainBoost = Math.min(20, rain * 8);              // at√© +20
      const cloudTerm = (100 - cloud) * 0.12;                // c√©u limpo ajuda um pouco (0-12)
      const tempTerm = 12 - Math.min(12, Math.abs(t - 26));  // melhor perto de 26¬∞C (0-12)

      let bio = (hum * 0.58) + cloudTerm + rainBoost + tempTerm;
      bio = Math.max(0, Math.min(100, Math.round(bio)));
      return bio;
    }

    // ====== Render ======
    async function atualizarTudo(){
      try{
        setStatus("Atualizando dados p√∫blicos‚Ä¶");
        document.getElementById("camadasStatus").textContent = "carregando";
        limparPontos();

        // busca clima em paralelo (8 pontos)
        const promises = pontosBase.map(async (p) => {
          const j = await fetchClima(p.lat, p.lon);
          const c = j.current || {};
          const bio = calcBioIndex(c);
          return { ...p, bio, current: c };
        });

        const pontos = await Promise.all(promises);

        // m√©dia
        const media = Math.round(pontos.reduce((a,b)=>a + (b.bio||0), 0) / pontos.length);
        document.getElementById("bioMedia").textContent = media;

        // pins
        let i = 0;
        for(const p of pontos){
          const color = corPorValor(p.bio);

          const m = L.marker([p.lat, p.lon], { icon: pulseIcon(color) });

          const html =
            `<strong>${p.nome}</strong><br>` +
            `BioIndex: <strong>${p.bio}</strong><br>` +
            `<span class="muted">Dados p√∫blicos (agora):</span><br>` +
            `Umidade: ${p.current.relative_humidity_2m ?? "‚Äî"}%<br>` +
            `Nuvens: ${p.current.cloud_cover ?? "‚Äî"}%<br>` +
            `Chuva: ${p.current.precipitation ?? "‚Äî"} mm<br>` +
            `Temp: ${p.current.temperature_2m ?? "‚Äî"} ¬∞C<br>` +
            `<span class="muted">lat: ${p.lat.toFixed(3)} | lon: ${p.lon.toFixed(3)}</span>`;

          m.bindPopup(html);

          m.on("click", ()=>{
            document.getElementById("selInfo").innerHTML =
              `<strong>${p.nome}</strong><br>` +
              `BioIndex: <strong>${p.bio}</strong><br>` +
              `Umidade: ${p.current.relative_humidity_2m ?? "‚Äî"}% ‚Ä¢ ` +
              `Nuvens: ${p.current.cloud_cover ?? "‚Äî"}% ‚Ä¢ ` +
              `Chuva: ${p.current.precipitation ?? "‚Äî"} mm ‚Ä¢ ` +
              `Temp: ${p.current.temperature_2m ?? "‚Äî"} ¬∞C`;
          });

          m.addTo(layerPontos);

          i++;
        }

        document.getElementById("pontosCount").textContent = `${pontos.length} pontos`;
        document.getElementById("camadasStatus").textContent = "online";
        setLastUpdate();
        setStatus("Dados p√∫blicos carregados. Clique nos pontos.");

      }catch(err){
        console.error(err);
        setStatus("Falha ao carregar (rede/API). Tente Atualizar.");
        document.getElementById("camadasStatus").textContent = "erro";
        alert("Erro ao carregar dados p√∫blicos: " + err.message);
      }
    }

    // Inicializa
    atualizarTudo();

    // Atualiza autom√°tico (10 min)
    setInterval(atualizarTudo, 10 * 60 * 1000);

    // ====== MODAIS ======
    const content = {
      oquee: {
        title: "üåø O que √© o Token Amaz√¥nia",
        body: `
          <p>
            O Token Amaz√¥nia √© um projeto de transpar√™ncia ambiental que utiliza
            <strong>dados p√∫blicos</strong> para monitorar, em escala continental,
            o estado ecol√≥gico da floresta amaz√¥nica.
          </p>
          <p class="muted">
            Este painel √© a prova visual do sistema em funcionamento.
          </p>
        `
      },
      comofunciona: {
        title: "‚öôÔ∏è Como funciona",
        body: `
          <p>
            Este painel integra camadas p√∫blicas (clima, sat√©lite, √≠ndices) para formar um
            <strong>BioIndex (0‚Äì100)</strong>.
          </p>
          <p class="muted">
            Hoje: o BioIndex √© derivado de dados clim√°ticos p√∫blicos em tempo real (umidade, nuvens e precipita√ß√£o).
            Pr√≥ximo passo: substituir/combinar com √≠ndice por sat√©lite (NDVI/Sentinel).
          </p>
        `
      },
      painel: {
        title: "üìä Painel Amaz√¥nia ‚Äî voc√™ encontra",
        body: `
          <ul class="bullet">
            <li><strong>Sistema ativo da Amaz√¥nia</strong></li>
            <li><strong>Dados p√∫blicos</strong></li>
            <li><strong>Atualiza√ß√£o cont√≠nua</strong></li>
          </ul>
          <p class="muted">
            Mapa sat√©lite real + pontos com leitura p√∫blica. Clique nos pontos para ver os dados usados no √≠ndice.
          </p>
        `
      }
    };

    function openModal(key){
      const overlay = document.getElementById("modalOverlay");
      const titleEl = document.getElementById("modalTitle");
      const bodyEl = document.getElementById("modalBody");
      const item = content[key];
      if(!item) return;
      titleEl.innerHTML = item.title;
      bodyEl.innerHTML = item.body;
      overlay.style.display = "flex";
    }
    function closeModal(){
      document.getElementById("modalOverlay").style.display = "none";
    }
    function overlayClick(e){
      if(e.target.id === "modalOverlay") closeModal();
    }
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape") closeModal();
    });
  </script>
</body>
</html>
