<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel AmazÃ´nia â€” Token AmazÃ´nia</title>

  <style>
    :root{
      --bg:#05080f;
      --panel: rgba(6,10,18,.78);
      --line: rgba(26,255,140,.25);
      --neon:#1aff8c;
      --text:#e4e9f2;
      --muted:#9bb0d3;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background: radial-gradient(circle at top, #071427, var(--bg));
      color: var(--text);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      border-bottom: 1px solid rgba(15,31,58,.55);
      background: linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.25));
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter: blur(10px);
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:900; }
    .badge{
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      padding:6px 10px;
      border-radius:999px;
      color: var(--neon);
      font-weight:900;
      font-size:.85em;
    }
    .nav{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .chip{
      display:flex; align-items:center; gap:8px;
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      transition:.2s;
      background: rgba(0,0,0,.25);
      font-weight:800;
      white-space:nowrap;
    }
    .chip:hover{ border-color: rgba(26,255,140,.55); box-shadow:0 0 18px rgba(26,255,140,.15); }
    .chip a{ color:inherit; text-decoration:none; }

    /* A IMAGEM Ã‰ O DASHBOARD INTEIRO */
    .dash{
      position:relative;
      width:100%;
      height: calc(100vh - 64px);
      overflow:hidden;
      border-top:1px solid rgba(26,255,140,.08);
    }
    .dash img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      filter: contrast(1.05) saturate(1.15);
    }

    /* camada por cima para desenhar pontos reais */
    canvas#layer{
      position:absolute;
      inset:0;
      z-index:2;
    }

    .tip{
      position:absolute;
      z-index:5;
      background: rgba(6,10,18,.92);
      border:1px solid rgba(26,255,140,.25);
      border-radius:12px;
      padding:10px 12px;
      min-width:220px;
      pointer-events:none;
      display:none;
      box-shadow: 0 10px 30px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    .tip .t{ font-weight:900; margin-bottom:6px; }
    .tip .m{ color: rgba(228,233,242,.75); font-size:.9em; line-height:1.35; }

    .muted{ color: var(--muted); }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <span class="badge">TOKEN AMAZÃ”NIA</span>
      <span class="muted">Painel (imagem) + dados reais (pontos)</span>
    </div>

    <div class="nav">
      <div class="chip"><a href="index.html">â¬… Voltar</a></div>
      <div class="chip" onclick="carregarDados()">ðŸ”„ Recarregar dados</div>
    </div>
  </div>

  <div class="dash" id="dash">
    <!-- A SUA IMAGEM = DASHBOARD -->
    <img src="amazonia-tech.jpg" alt="Dashboard AmazÃ´nia" />

    <!-- camada de dados -->
    <canvas id="layer"></canvas>

    <!-- tooltip -->
    <div class="tip" id="tip">
      <div class="t" id="tipTitle">Ponto</div>
      <div class="m" id="tipMeta">â€¦</div>
    </div>
  </div>

  <script>
    const dash = document.getElementById("dash");
    const canvas = document.getElementById("layer");
    const ctx = canvas.getContext("2d");

    const tip = document.getElementById("tip");
    const tipTitle = document.getElementById("tipTitle");
    const tipMeta = document.getElementById("tipMeta");

    let W=0, H=0;
    let DATA = null;

    function resize(){
      const r = dash.getBoundingClientRect();
      W = canvas.width = Math.floor(r.width);
      H = canvas.height = Math.floor(r.height);
      desenhar();
    }
    window.addEventListener("resize", resize);

    function corPorValor(v){
      if(v < 40) return "rgba(255,70,70,.95)";      // vermelho
      if(v < 70) return "rgba(255,210,60,.95)";     // amarelo
      return "rgba(26,255,140,.95)";                // verde
    }

    // Converte lat/lon para X/Y usando bounds (aproximaÃ§Ã£o inicial)
    function latLonParaXY(lat, lon, bounds){
      const x = (lon - bounds.minLon) / (bounds.maxLon - bounds.minLon);
      const y = 1 - (lat - bounds.minLat) / (bounds.maxLat - bounds.minLat);
      return { x: x*W, y: y*H };
    }

    function desenhar(){
      ctx.clearRect(0,0,W,H);
      if(!DATA) return;

      ctx.save();
      ctx.globalCompositeOperation = "lighter";

      for(const p of DATA.points){
        const pos = latLonParaXY(p.lat, p.lon, DATA.bounds);
        const c = corPorValor(p.valor);

        // halo
        ctx.beginPath();
        ctx.fillStyle = c.replace("0.95","0.22");
        ctx.arc(pos.x, pos.y, 18, 0, Math.PI*2);
        ctx.fill();

        // ponto principal
        ctx.beginPath();
        ctx.fillStyle = c;
        ctx.arc(pos.x, pos.y, 6, 0, Math.PI*2);
        ctx.fill();

        // anel
        ctx.beginPath();
        ctx.strokeStyle = c.replace("0.95","0.45");
        ctx.lineWidth = 2;
        ctx.arc(pos.x, pos.y, 10, 0, Math.PI*2);
        ctx.stroke();
      }

      ctx.restore();
    }

    async function carregarDados(){
      try{
        const res = await fetch("dados.json", { cache: "no-store" });
        if(!res.ok) throw new Error("NÃ£o achei dados.json (erro " + res.status + ")");
        DATA = await res.json();
        desenhar();
      }catch(err){
        alert("Erro ao carregar dados: " + err.message);
      }
    }

    // Tooltip: pega o ponto mais prÃ³ximo
    dash.addEventListener("mousemove", (e)=>{
      if(!DATA) return;

      const rect = dash.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;

      let best=null, bestD=999999;

      for(const p of DATA.points){
        const {x,y} = latLonParaXY(p.lat, p.lon, DATA.bounds);
        const dx = mx - x, dy = my - y;
        const d = dx*dx + dy*dy;
        if(d < bestD){
          bestD = d;
          best = {p, x, y};
        }
      }

      if(best && bestD < 22*22){
        tip.style.display = "block";
        tip.style.left = Math.min(mx + 14, W - 240) + "px";
        tip.style.top  = Math.max(my - 10, 14) + "px";
        tipTitle.textContent = (best.p.nome || "Ponto") + " â€¢ " + best.p.valor;
        tipMeta.textContent = "lat: " + best.p.lat + " | lon: " + best.p.lon + " | valor: " + best.p.valor;
      }else{
        tip.style.display = "none";
      }
    });

    dash.addEventListener("mouseleave", ()=> tip.style.display = "none");

    // init
    resize();
    carregarDados();
  </script>
</body>
</html>
