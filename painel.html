<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Painel Amaz√¥nia ‚Äî Observat√≥rio Bioecol√≥gico</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <!-- Turf (point in polygon + bbox) -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <style>
    :root{
      --bg:#05080f;
      --panel: rgba(6,10,18,.82);
      --line: rgba(26,255,140,.25);
      --neon:#1aff8c;
      --text:#e4e9f2;
      --muted:#9bb0d3;
      --red:#ff3b3b;
      --yellow:#ffd24d;
      --green:#1aff8c;
      --blue:#33b6ff;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
      overflow:hidden;
    }

    .topbar{
      position:fixed;
      top:10px;
      left:10px;
      right:10px;
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:16px;
      backdrop-filter: blur(10px);
    }
    .brand{
      font-weight:900;
      letter-spacing:.3px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .brand small{ color:rgba(228,233,242,.75); font-weight:700; }

    .chips{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      transition:.2s;
      background: rgba(0,0,0,.25);
      font-weight:900;
      white-space:nowrap;
    }
    .chip:hover{
      border-color: rgba(26,255,140,.55);
      box-shadow:0 0 18px rgba(26,255,140,.12);
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      padding:10px 14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      border-radius:999px;
      cursor:pointer;
      font-weight:900;
    }
    .btn.primary{
      border-color: rgba(26,255,140,.55);
      color:var(--neon);
    }
    .btn:hover{
      box-shadow:0 0 18px rgba(26,255,140,.12);
      border-color: rgba(26,255,140,.55);
    }

    .grid{
      position:fixed;
      inset:70px 10px 10px 10px;
      display:grid;
      grid-template-columns: 330px 1fr 330px;
      grid-template-rows: 1fr 180px;
      gap:10px;
      z-index:1;
    }

    .panel{
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:16px;
      backdrop-filter: blur(10px);
      padding:12px;
      overflow:hidden;
    }

    .left{ grid-column:1; grid-row:1; }
    .mapWrap{ grid-column:2; grid-row:1; position:relative; }
    .right{ grid-column:3; grid-row:1; }

    .bottomL{ grid-column:1; grid-row:2; }
    .bottomM{ grid-column:2; grid-row:2; }
    .bottomR{ grid-column:3; grid-row:2; }

    #map{
      position:absolute;
      inset:0;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(26,255,140,.20);
    }

    .muted{ color:var(--muted); }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .tag{
      font-size:.85em;
      padding:4px 8px;
      border:1px solid var(--line);
      border-radius:999px;
      color:rgba(228,233,242,.85);
      background: rgba(0,0,0,.25);
    }
    .hr{ height:1px; background:rgba(26,255,140,.12); margin:10px 0; }

    .legendDot{
      width:10px; height:10px; border-radius:999px; display:inline-block; margin-right:8px;
      box-shadow: 0 0 12px rgba(255,255,255,.12);
    }

    .slider{
      width:100%;
      accent-color: var(--neon);
    }

    /* HUD boxes on map */
    .hudBox{
      position:absolute;
      z-index:800;
      border:1px solid rgba(26,255,140,.22);
      background: rgba(6,10,18,.72);
      border-radius:12px;
      padding:10px;
      backdrop-filter: blur(10px);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      color:rgba(228,233,242,.92);
      max-width: 360px;
    }
    .hudTop{
      top:10px;
      left:10px;
    }
    .hudScale{
      left:10px;
      bottom:10px;
      min-width: 280px;
    }
    .scaleBar{
      height:10px;
      border-radius:999px;
      background: linear-gradient(90deg, var(--red), var(--yellow), var(--green));
      border:1px solid rgba(255,255,255,.08);
      margin-top:8px;
      position:relative;
      overflow:hidden;
    }
    .scaleLabels{
      display:flex;
      justify-content:space-between;
      font-size:.78em;
      color:rgba(228,233,242,.70);
      margin-top:6px;
    }

    /* Modal */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.70);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10000;
    }
    .modal{
      width:min(820px, calc(100vw - 28px));
      background: rgba(6,10,18,.90);
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px;
      backdrop-filter: blur(12px);
      box-shadow:0 10px 40px rgba(0,0,0,.55);
    }
    .close{
      float:right;
      cursor:pointer;
      font-weight:900;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
    }
    .close:hover{ border-color: rgba(26,255,140,.55); }
    .modalTitle{ font-weight:900; font-size:1.1em; }
    .modalBody{ margin-top:10px; line-height:1.6; color:#dfe7ff; }
    ul.bullet{ padding-left:18px; }
    ul.bullet li{ margin:8px 0; }

    /* Mobile */
    @media (max-width: 1100px){
      body{ overflow:auto; }
      .grid{
        position:relative;
        inset:auto;
        margin-top:80px;
        grid-template-columns: 1fr;
        grid-template-rows: auto;
        height:auto;
      }
      .left,.mapWrap,.right,.bottomL,.bottomM,.bottomR{ grid-column:1; }
      .mapWrap{ height: 65vh; }
      #map{ position:relative; height:65vh; }
    }
  </style>
</head>

<body>

  <div class="topbar">
    <div class="brand">
      PAINEL AMAZ√îNIA ‚Äî Observat√≥rio Bioecol√≥gico
      <small>Dados p√∫blicos ‚Ä¢ Atualiza√ß√£o cont√≠nua ‚Ä¢ Escala 0‚Äì100</small>
      <span class="tag" id="statusOnline">online</span>
    </div>

    <div class="chips">
      <div class="chip" onclick="openModal('oquee')">üåø O que √©</div>
      <div class="chip" onclick="openModal('comofunciona')">‚öôÔ∏è Como funciona</div>
      <div class="chip" onclick="openModal('painel')">üìä Painel</div>
      <div class="chip" id="toggleNDVI" title="Liga/desliga NDVI">üå± NDVI</div>
    </div>

    <div class="actions">
      <button class="btn" onclick="window.location.href='index.html'">‚Üê Voltar</button>
      <button class="btn primary" onclick="atualizarTudo()">‚ü≥ Atualizar</button>
    </div>
  </div>

  <div class="grid">
    <!-- LEFT -->
    <div class="panel left">
      <div class="row">
        <div style="font-weight:900;">üß≠ Camadas P√∫blicas</div>
        <div class="tag" id="tagConn">online</div>
      </div>
      <div class="hr"></div>

      <div style="font-weight:900; margin-bottom:6px;">Base</div>
      <div class="muted">Sat√©lite (NASA GIBS / VIIRS)</div>

      <div style="font-weight:900; margin-top:12px; margin-bottom:6px;">Dist√∫rbio real</div>
      <div class="muted">Inc√™ndios (NASA EONET)</div>

      <div class="hr"></div>

      <div style="font-weight:900; margin-bottom:6px;">Regra</div>
      <div class="muted" style="line-height:1.9;">
        <span class="legendDot" style="background:var(--green)"></span> sem dist√∫rbio<br/>
        <span class="legendDot" style="background:var(--yellow)"></span> alerta<br/>
        <span class="legendDot" style="background:var(--red)"></span> dist√∫rbio (evento real)
      </div>

      <div class="hr"></div>

      <div class="muted" style="font-size:.92em; line-height:1.6;">
        <div><b>Atualiza√ß√£o:</b> <span id="tsUpdate">‚Äî</span></div>
        <div><b>Eventos (Amaz√¥nia):</b> <span id="countEvents">‚Äî</span></div>
        <div><b>Pontos desenhados:</b> <span id="countPixels">‚Äî</span></div>
      </div>

      <div class="hr"></div>

      <div style="font-weight:900; margin-bottom:8px;">Densidade (pixel)</div>
      <input class="slider" id="density" type="range" min="6" max="24" value="12" />
      <div class="muted" style="font-size:.86em; margin-top:6px;">
        Menor = mais detalhado (pesa mais). Recomendado: 10‚Äì16.
      </div>
    </div>

    <!-- MAP -->
    <div class="panel mapWrap">
      <div id="map"></div>

      <!-- HUD -->
      <div class="hudBox hudTop">
        <div style="font-weight:900;">‚úÖ Sistema ativo ‚Äî Amaz√¥nia</div>
        <div class="muted" style="margin-top:4px; font-size:.92em;">
          Camada hologr√°fica recortada no bioma + dist√∫rbios reais (EONET). Clique em um ponto.
        </div>
      </div>

      <div class="hudBox hudScale">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <div style="font-weight:900;">Escala Ecol√≥gica (0‚Äì100)</div>
          <div class="tag">MVP</div>
        </div>
        <div class="scaleBar"></div>
        <div class="scaleLabels">
          <span>impacto</span><span>alerta</span><span>baixo dist√∫rbio</span>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="panel right">
      <div class="row">
        <div style="font-weight:900;">üì° Leituras em tempo real</div>
        <div class="tag"><span id="liveCount">‚Äî</span> pontos</div>
      </div>
      <div class="hr"></div>

      <div class="muted" style="font-size:.92em; line-height:1.6;">
        Clique em um ponto para ver a classifica√ß√£o e a dist√¢ncia do dist√∫rbio real.
      </div>

      <div class="hr"></div>

      <div style="font-weight:900; margin-bottom:8px;">√öltimo ponto selecionado</div>
      <div class="muted" id="lastPick">‚Äî</div>
    </div>

    <!-- Bottom -->
    <div class="panel bottomL">
      <div class="row">
        <div style="font-weight:900;">üìà S√©rie temporal (MVP)</div>
        <div class="tag">placeholder</div>
      </div>
      <div class="hr"></div>
      <div class="muted">
        Pr√≥ximo passo: gr√°fico real do √≠ndice por dia/semana (NDVI + fogo + anomalias + clima + desmatamento).
      </div>
    </div>

    <div class="panel bottomM">
      <div class="row">
        <div style="font-weight:900;">üß¨ Integridade / Cobertura</div>
        <div class="tag">placeholder</div>
      </div>
      <div class="hr"></div>
      <div class="muted">
        Pr√≥ximo passo: m√©tricas reais por sat√©lite (NDVI/biomassa) + mudan√ßas de cobertura (desmatamento/alertas).
      </div>
    </div>

    <div class="panel bottomR">
      <div class="row">
        <div style="font-weight:900;">üîí Transpar√™ncia</div>
        <div class="tag">jur√≠dico</div>
      </div>
      <div class="hr"></div>
      <div class="muted">
        Observat√≥rio Amaz√¥nia ‚Äî Transpar√™ncia ambiental baseada em dados p√∫blicos.<br/>
        Este projeto n√£o constitui oferta de investimento. Plataforma de monitoramento ambiental.
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modalOverlay" id="modalOverlay" onclick="overlayClick(event)">
    <div class="modal">
      <div class="close" onclick="closeModal()">Fechar ‚úï</div>
      <div class="modalTitle" id="modalTitle"></div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ===============================
    // CONFIG
    // ===============================
    const GEOJSON_URL = "amz.geojson"; // sem acento, sem espa√ßo
    const EONET_WILDFIRES = "https://eonet.gsfc.nasa.gov/api/v3/events?status=open&category=wildfires&days=30";

    // Regras (MVP) por DIST√ÇNCIA ao dist√∫rbio real (km)
    // üî¥ <= 75 km | üü° <= 180 km | üü¢ > 180 km
    const TH_RED_KM = 75;
    const TH_YELLOW_KM = 180;

    // ===============================
    // MAP LAYERS (GIBS)
    // ===============================
    // Base sat√©lite (VIIRS Corrected Reflectance True Color)
    // (esse endpoint √© p√∫blico; Leaflet usa x/y/z)
    const GIBS_BASE = L.tileLayer(
      "https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/VIIRS_SNPP_CorrectedReflectance_TrueColor/default/2019-01-01/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg",
      { maxZoom: 9, attribution: "Leaflet | NASA GIBS (VIIRS)" }
    );

    // NDVI (MODIS Terra 16-day NDVI) - camada opcional
    const GIBS_NDVI = L.tileLayer(
      "https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_NDVI_16Day/default/2019-01-01/GoogleMapsCompatible_Level9/{z}/{y}/{x}.png",
      { maxZoom: 9, opacity: 0.55, attribution: "NASA GIBS (NDVI)" }
    );

    // ===============================
    // MAP INIT (centraliza Amaz√¥nia)
    // ===============================
    const map = L.map("map", {
      zoomControl: true,
      preferCanvas: true
    });

    GIBS_BASE.addTo(map);

    // Ajuste inicial (Amaz√¥nia aproximada)
    map.setView([-5.5, -62], 4);

    // ===============================
    // STATE
    // ===============================
    let ndviOn = false;
    let amazoniaFeature = null;
    let eonetEvents = []; // {lat, lon, dateISO, title}
    let pixelLayer = L.layerGroup().addTo(map);
    let eventLayer = L.layerGroup().addTo(map);

    // ===============================
    // UI
    // ===============================
    const $ = (id)=>document.getElementById(id);

    $("toggleNDVI").addEventListener("click", ()=>{
      ndviOn = !ndviOn;
      if(ndviOn) {
        GIBS_NDVI.addTo(map);
        $("toggleNDVI").style.borderColor = "rgba(26,255,140,.55)";
        $("toggleNDVI").style.boxShadow = "0 0 18px rgba(26,255,140,.12)";
      } else {
        map.removeLayer(GIBS_NDVI);
        $("toggleNDVI").style.borderColor = "rgba(26,255,140,.25)";
        $("toggleNDVI").style.boxShadow = "none";
      }
    });

    $("density").addEventListener("input", ()=>{
      // s√≥ redesenha pixels, n√£o precisa refazer eventos
      desenharPixels();
    });

    // ===============================
    // COLOR / SCORE
    // ===============================
    function classificarPorDistKm(distKm){
      if(distKm <= TH_RED_KM) return "vermelho";
      if(distKm <= TH_YELLOW_KM) return "amarelo";
      return "verde";
    }

    function corDaClasse(cls){
      if(cls === "vermelho") return getComputedStyle(document.documentElement).getPropertyValue("--red").trim();
      if(cls === "amarelo") return getComputedStyle(document.documentElement).getPropertyValue("--yellow").trim();
      return getComputedStyle(document.documentElement).getPropertyValue("--green").trim();
    }

    function scoreDaClasse(cls){
      // MVP simples (depois vira √≠ndice real)
      if(cls === "vermelho") return 20;
      if(cls === "amarelo") return 55;
      return 85;
    }

    // Haversine (km)
    function distKm(aLat,aLon,bLat,bLon){
      const R=6371;
      const dLat=(bLat-aLat)*Math.PI/180;
      const dLon=(bLon-aLon)*Math.PI/180;
      const lat1=aLat*Math.PI/180;
      const lat2=bLat*Math.PI/180;
      const x=Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(x));
    }

    function distMinimaParaEventos(lat, lon){
      if(!eonetEvents.length) return Infinity;
      let min = Infinity;
      for(const ev of eonetEvents){
        const d = distKm(lat, lon, ev.lat, ev.lon);
        if(d < min) min = d;
      }
      return min;
    }

    // ===============================
    // LOAD DATA
    // ===============================
    async function carregarGeojson(){
      const res = await fetch(GEOJSON_URL, { cache:"no-store" });
      if(!res.ok) throw new Error("Nao achei " + GEOJSON_URL + " (erro " + res.status + ")");
      const gj = await res.json();
      // garante FeatureCollection/Feature
      amazoniaFeature = (gj.type === "Feature") ? gj : gj.features?.[0];
      if(!amazoniaFeature) throw new Error("GeoJSON invalido (sem feature).");

      // zoom no bioma
      const bbox = turf.bbox(amazoniaFeature);
      const bounds = L.latLngBounds([bbox[1], bbox[0]], [bbox[3], bbox[2]]);
      map.fitBounds(bounds.pad(0.12));

      // desenha contorno (fino, estilo HUD)
      L.geoJSON(amazoniaFeature, {
        style: {
          color: "rgba(26,255,140,.55)",
          weight: 2,
          fillColor: "rgba(26,255,140,.05)",
          fillOpacity: 0.08
        }
      }).addTo(map);
    }

    async function carregarEonet(){
      const res = await fetch(EONET_WILDFIRES, { cache:"no-store" });
      if(!res.ok) throw new Error("EONET falhou (erro " + res.status + ")");
      const data = await res.json();

      const events = [];
      for(const ev of (data.events || [])){
        const title = ev.title || "Evento";
        // pega √∫ltima geometria (ponto)
        const geo = (ev.geometry && ev.geometry.length) ? ev.geometry[ev.geometry.length-1] : null;
        if(!geo || geo.type !== "Point") continue;
        const [lon, lat] = geo.coordinates;
        const date = geo.date || ev.updated || "";
        events.push({ lat, lon, title, dateISO: date });
      }

      // filtra por "dentro/entorno" do bioma (bbox + point-in-polygon)
      // (primeiro bbox r√°pido, depois PIP)
      const bbox = turf.bbox(amazoniaFeature);
      const poly = amazoniaFeature;

      const filtered = [];
      for(const e of events){
        if(e.lon < bbox[0] || e.lon > bbox[2] || e.lat < bbox[1] || e.lat > bbox[3]) continue;
        const pt = turf.point([e.lon, e.lat]);
        if(turf.booleanPointInPolygon(pt, poly)) filtered.push(e);
      }

      eonetEvents = filtered;
      $("countEvents").textContent = String(eonetEvents.length);

      // markers ‚Äúdist√∫rbio real‚Äù (vermelho com halo)
      eventLayer.clearLayers();
      for(const ev of eonetEvents){
        const c = getComputedStyle(document.documentElement).getPropertyValue("--red").trim();
        const m = L.circleMarker([ev.lat, ev.lon], {
          radius: 5,
          color: c,
          weight: 2,
          fillColor: c,
          fillOpacity: 0.75
        });

        const halo = L.circleMarker([ev.lat, ev.lon], {
          radius: 16,
          color: c,
          weight: 0,
          fillColor: c,
          fillOpacity: 0.16
        });

        const html = `
          <div style="font-weight:900; margin-bottom:6px;">üî• Disturbio real</div>
          <div><b>${ev.title}</b></div>
          <div class="muted" style="margin-top:6px;">Fonte: NASA EONET</div>
          <div class="muted">Data: ${String(ev.dateISO).slice(0,19).replace("T"," ")}</div>
          <div class="muted">Lat: ${ev.lat.toFixed(3)} | Lon: ${ev.lon.toFixed(3)}</div>
        `;
        m.bindPopup(html);

        halo.addTo(eventLayer);
        m.addTo(eventLayer);
      }
    }

    // ===============================
    // PIXEL / HOLO LAYER (sem ‚Äúmancha‚Äù)
    // ===============================
    function limparPixels(){
      pixelLayer.clearLayers();
      $("countPixels").textContent = "0";
      $("liveCount").textContent = "0";
    }

    function desenharPixels(){
      if(!amazoniaFeature) return;
      limparPixels();

      const poly = amazoniaFeature;
      const bbox = turf.bbox(poly);

      // "densidade" = passo em km aproximado por grau (simplificado)
      // Slider 6..24 -> vira um passo em graus
      const density = Number($("density").value); // 6..24
      // passo em graus: menor = mais pontos; maior = menos pontos
      const stepDeg = density / 100; // 0.06..0.24

      let count = 0;

      // Para n√£o virar "mancha s√≥lida":
      // - bolinha menor
      // - fillOpacity baixo
      // - halo muito sutil
      // - espa√ßamento real (stepDeg)
      for(let lon = bbox[0]; lon <= bbox[2]; lon += stepDeg){
        for(let lat = bbox[1]; lat <= bbox[3]; lat += stepDeg){
          const pt = turf.point([lon, lat]);
          if(!turf.booleanPointInPolygon(pt, poly)) continue;

          const d = distMinimaParaEventos(lat, lon); // km
          const cls = classificarPorDistKm(d);
          const c = corDaClasse(cls);

          // ‚Äúhologr√°fico‚Äù (ponto + halo)
          const dot = L.circleMarker([lat, lon], {
            radius: 2.8,           // pequeno = aspecto ‚Äúpixel‚Äù
            color: c,
            weight: 0,
            fillColor: c,
            fillOpacity: 0.65
          });

          const halo = L.circleMarker([lat, lon], {
            radius: 8.5,
            color: c,
            weight: 0,
            fillColor: c,
            fillOpacity: 0.10
          });

          const score = scoreDaClasse(cls);
          const txtClasse = (cls==="vermelho") ? "disturbio" : (cls==="amarelo" ? "alerta" : "sem disturbio");

          dot.on("click", ()=>{
            $("lastPick").innerHTML =
              `<b>Classificacao:</b> <span style="color:${c}; font-weight:900;">${txtClasse}</span><br>` +
              `<b>Distancia ao disturbio mais proximo:</b> ${isFinite(d) ? d.toFixed(1)+" km" : "‚Äî"}<br>` +
              `<b>Indice (MVP):</b> ${score} / 100<br>` +
              `<span class="muted">Lat: ${lat.toFixed(3)} | Lon: ${lon.toFixed(3)}</span>`;
          });

          halo.addTo(pixelLayer);
          dot.addTo(pixelLayer);

          count++;
        }
      }

      $("countPixels").textContent = String(count);
      $("liveCount").textContent = String(count);
    }

    // ===============================
    // MAIN UPDATE
    // ===============================
    async function atualizarTudo(){
      try{
        $("statusOnline").textContent = "atualizando";
        $("tagConn").textContent = "online";
        $("statusOnline").style.color = "rgba(228,233,242,.85)";

        $("tsUpdate").textContent = new Date().toLocaleString("pt-BR");

        // carrega geojson uma vez
        if(!amazoniaFeature) await carregarGeojson();

        // carrega dist√∫rbios reais
        await carregarEonet();

        // desenha camada hologr√°fica
        desenharPixels();

        $("statusOnline").textContent = "online";
      }catch(err){
        console.error(err);
        $("statusOnline").textContent = "erro";
        $("tagConn").textContent = "erro";
        alert("Erro ao atualizar: " + err.message);
      }
    }

    // ===== MODAIS =====
    const content = {
      oquee: {
        title: "üåø O que √© o Observat√≥rio Bioecol√≥gico da Amaz√¥nia",
        body: `
          <p>
            Um painel p√∫blico que transforma <b>dados ambientais reais</b> em uma leitura visual do
            estado ecol√≥gico da floresta.
          </p>
          <p class="muted">
            Sem pre√ßo, sem promessa, sem venda: apenas monitoramento verific√°vel.
          </p>
        `
      },
      comofunciona: {
        title: "‚öôÔ∏è Como funciona (MVP)",
        body: `
          <ul class="bullet">
            <li><b>Sat√©lite real</b> (NASA GIBS / VIIRS) como base do mapa.</li>
            <li><b>Vegeta√ß√£o</b> (NDVI) como camada bi√≥tica <span class="muted">(j√° dispon√≠vel no toggle üå±)</span>.</li>
            <li><b>Dist√∫rbios</b> (inc√™ndios) via <b>NASA EONET</b> <span class="muted">(eventos reais)</span>.</li>
            <li><b>Pixels</b> dentro do bioma (GeoJSON): cada ponto √© uma leitura visual.</li>
          </ul>
          <p class="muted">
            Regra do Observat√≥rio: <b>dist√∫rbio</b> = üî¥ ‚Ä¢ <b>alerta</b> = üü° ‚Ä¢ <b>sem dist√∫rbio</b> = üü¢.
            No MVP atual, a cor √© definida pela <b>dist√¢ncia ao dist√∫rbio real</b> mais pr√≥ximo (EONET).
          </p>
        `
      },
      painel: {
        title: "üìä Painel Amaz√¥nia ‚Äî voc√™ encontra",
        body: `
          <ul class="bullet">
            <li><b>Sistema ativo da Amaz√¥nia</b></li>
            <li><b>Dados p√∫blicos</b></li>
            <li><b>Atualiza√ß√£o cont√≠nua</b></li>
          </ul>
          <p class="muted">
            Mapa sat√©lite real + NDVI + dist√∫rbios reais (EONET) + pixels hologr√°ficos dentro do bioma. Clique em um ponto.
          </p>
        `
      }
    };

    function openModal(key){
      const overlay = document.getElementById("modalOverlay");
      const titleEl = document.getElementById("modalTitle");
      const bodyEl = document.getElementById("modalBody");
      const item = content[key];
      if(!item) return;
      titleEl.innerHTML = item.title;
      bodyEl.innerHTML = item.body;
      overlay.style.display = "flex";
    }
    function closeModal(){ document.getElementById("modalOverlay").style.display = "none"; }
    function overlayClick(e){ if(e.target.id === "modalOverlay") closeModal(); }
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

    // start
    atualizarTudo();
    setInterval(atualizarTudo, 10 * 60 * 1000);
  </script>
</body>
</html>
